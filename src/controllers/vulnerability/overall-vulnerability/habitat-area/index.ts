import {
  HabitatAreaOverallVulnerabilityControllerRequest,
  HabitatAreaOverallVulnerabilityControllerResponse,
} from "./types";
import { getAreaMigrationsFlightHeightsDistribution } from "./utils/get-area-migrations-flight-heights-distribution";
import { getAreaMigrationsDensity } from "../../../../services/spatial-services/track-density/get-area-migrations-density";
import { areaVulnerabilityController } from "../index";

export const habitatAreaOverallVulnerabilityController = async (
  request: HabitatAreaOverallVulnerabilityControllerRequest
): Promise<HabitatAreaOverallVulnerabilityControllerResponse> => {
  const flightheights = getAreaMigrationsFlightHeightsDistribution(
    request.area,
    request.migrations
  );
  const birdDensitiesPerMonth = getAreaMigrationsDensity({
    migrations: request.migrations,
    area: request.area,
    birds_count: request.birds_count,
  });
  const vulnerabilityResult = await areaVulnerabilityController({
    ...request,
    flightheights,
    birdDensitiesPerMonth,
  });

  return { birds_count: request.birds_count, ...vulnerabilityResult };
};
